<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 重构之设计模式 · GeekCoder</title><meta name="description" content="重构之设计模式 - EthanXQ"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/test_page/favicon.ico"><link rel="stylesheet" href="/test_page/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.igeekcoder.com/test_page/atom.xml" title="GeekCoder"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/test_page/atom.xml" title="GeekCoder" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">GeekCoder</h2></a></div><a href="/test_page/" target="_self" class="li component-nav-item"><p>INDEX</p></a><a href="/test_page/archives" target="_self" class="li component-nav-item"><p>ARCHIVES</p></a><a href="/test_page/tags" target="_self" class="li component-nav-item"><p>TAGS</p></a><ul class="shortcut-icons"><a href="https://github.com/igeekcoder" target="_blank"><img src="/images/github.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">重构之设计模式</h1><div class="post-info">Jul 26, 2020</div><div class="post-content"><h1 id="重构之常用设计模式"><a href="#重构之常用设计模式" class="headerlink" title="重构之常用设计模式"></a>重构之常用设计模式</h1><p>程序员三板斧：<code>数据结构</code>、<code>算法</code>、<code>设计模式</code></p>
<p>作为程序员无论你学习使用的是哪种语言，这三板斧都需要涉及甚至是需要深入了解的，这也是一个程序员基本功的展现，最近在做一些业务代码的重构也尝试使用了一些设计模式，今天和大家聊一聊我的一些见解和工作常用的一些<code>设计模式</code></p>
<h4 id="设计模式是什么？"><a href="#设计模式是什么？" class="headerlink" title="设计模式是什么？"></a>设计模式是什么？</h4><blockquote>
<p>设计模式（Design Pattern）是一套被反复使用、多数人知晓的、经过分类的、代码设计经验的总结。使用设计模式的目的：为了代码可重用性、让代码更容易被他人理解、保证代码可靠性。 设计模式使代码编写真正工程化；设计模式是软件工程的基石脉络，如同大厦的结构一样。</p>
<p>项目中合理的运用设计模式可以完美的解决很多问题，每种模式在现实中都有相应的原理来与之对应，每一个模式描述了一个在我们周围不断重复发生的问题，以及该问题的核心解决方案，这也是它能被广泛应用的原因。</p>
</blockquote>
<h4 id="常用的设计模式"><a href="#常用的设计模式" class="headerlink" title="常用的设计模式"></a>常用的设计模式</h4><h5 id="1-单例模式"><a href="#1-单例模式" class="headerlink" title="1.单例模式"></a>1.单例模式</h5><p>单例（Singleton）模式要求一个类有且仅有一个实例，并且提供了一个全局的访问点。在实际开发过程中，我们常常需要保存一些数据实现全局共享，这时候就需要用到单例模式。单例模式是在实际开发过程中使用比较多的一种设计模式。</p>
<blockquote>
<p>单例模式在spring中广泛应用 spring默认bean也是单例，适用于一些无状态的类，减少类的创建和销毁，需要注意的是共享变量需要考虑线程安全的问题，相对比较简单对于有些设计模式大师来说可能都算不上一种设计模式，更确切的来说是一种方法技巧, 这里就不详细分析了</p>
</blockquote>
<h5 id="2-策略模式"><a href="#2-策略模式" class="headerlink" title="2.策略模式"></a>2.策略模式</h5><p>举个栗子:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单支付</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> payType</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> orderBO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span> <span class="params">(String payType, OrderBO orderBO)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"paypal"</span>.equals(payType)) &#123;</span><br><span class="line">        <span class="comment">// paypal 支付逻辑</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"wechatPay"</span>.equals(payType)) &#123;</span><br><span class="line">        <span class="comment">// 微信支付逻辑</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"aliPay"</span>.equals(payType)) &#123;</span><br><span class="line">        <span class="comment">// 支付宝支付逻辑</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"unionPay"</span>.equals(payType))&#123;</span><br><span class="line">        <span class="comment">// 银联支付逻辑</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>类似上面这段代码，我们在平时开发中可能会经常见到，存在什么问题？条件分支多，并且可能有持续增长的趋势 ，更有些判断条件复杂，上下文中的参数可能相互影响 并且if 里面可能还需要嵌套 if 或者 循环体 整个代码看着就很臃肿改起来很容易出错， 下面我们用策略模式实现</p>
</blockquote>
<h6 id="策略模式的定义："><a href="#策略模式的定义：" class="headerlink" title="策略模式的定义："></a>策略模式的定义：</h6><p>策略模式定义了算法族，分别封装起来，让他们之间可以互相替换，此模式让算法的变化独立于使用算法的客户，一般情况下我们是将一种行为写成一个类方法，比如计算器类中有加、减、乘、除四种方法，而策略模式则是将每一种算法都写成一个类，然后动态地选择使用哪一个算法</p>
<p><img src="/2020/07/26/%E9%87%8D%E6%9E%84%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/2222997-69678af9fd117ec3.webp" alt="img"></p>
<p>从 UML 类图中，我们可以看到，<code>策略模式</code> 主要包含三种角色：</p>
<ul>
<li><p><strong>上下文角色（Context）</strong>：用来操作策略的上下文环境，屏蔽高层模块（客户端）对策略，算法的直接访问，封装可能存在的变化；</p>
</li>
<li><p><strong>抽象策略角色（Strategy）</strong>：规定策略或算法的行为；</p>
</li>
<li><p><strong>具体策略角色（ConcreteStrategy）</strong>：具体的策略或算法实现；</p>
</li>
</ul>
<p>在<code>Spring</code>中使用策略模式后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 支付接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> orderBO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Payment</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pay</span><span class="params">( OrderBO orderBO)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"paypal"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayPal</span> <span class="keyword">implements</span> <span class="title">Payment</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(OrderBO orderBO)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// paypal 支付</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"wechatPay"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatPay</span> <span class="keyword">implements</span> <span class="title">Payment</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(OrderBO orderBO)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// wechatPay 支付逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AliPay</span> <span class="keyword">implements</span> <span class="title">Payment</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(OrderBO orderBO)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// aliPay 支付逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"aliPay"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">........</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayTest</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Payment&gt; paymentMap;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(String payType, OrderBO orderBO)</span> </span>&#123;</span><br><span class="line">        Payment payment = paymentMap.get(payType);</span><br><span class="line">        payment.pay(orderBO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>这样各种支付方式相互独立清晰，需要接入新的支付方式只需要实现<code>Payment</code> 接口就可以了原有的支付逻辑都是可以不用去改变，从而实现 开闭原则（对扩展开放，对修改关闭）。</p>
<h5 id="3-责任链模式"><a href="#3-责任链模式" class="headerlink" title="3.责任链模式"></a>3.责任链模式</h5><p>责任链，顾名思义，就是用来处理相关事务责任的一条执行链，执行链上有多个节点，每个节点都有机会（条件匹配）处理请求事务，如果某个节点处理完了就可以根据实际业务需求传递给下一个节点继续处理或者返回处理完毕。</p>
<p><img src="/2020/07/26/%E9%87%8D%E6%9E%84%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/2222997-7caeb17aacd80332.webp" alt="img"></p>
<h6 id="简单责任链"><a href="#简单责任链" class="headerlink" title="简单责任链"></a>简单责任链</h6><p>举个栗子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注册</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(CustomerInfo customerInfo)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    save(customerInfo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.发送邮件</span></span><br><span class="line">    sendSuccessEmail(customerInfo.getEmail());</span><br><span class="line">    <span class="comment">// 2.初始化setting</span></span><br><span class="line">    initSetting(customerInfo);</span><br><span class="line">    <span class="comment">// 3.购买默认0元套餐</span></span><br><span class="line">    buyCombo(customerInfo.getCustomerCode());</span><br><span class="line">    <span class="comment">// 4.默认选择</span></span><br><span class="line">    selectPackageMethod(customerInfo);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. 6 7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下单</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">(OrderBO orderBO)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1.基本参数检查</span></span><br><span class="line">    checkParam(orderBO);</span><br><span class="line">    <span class="comment">// 2.风控检查</span></span><br><span class="line">    riskCheck(orderBo)</span><br><span class="line">    <span class="comment">// 3.商品库存检查</span></span><br><span class="line">    checkGoods(orderBo)</span><br><span class="line">    <span class="comment">// 4. 5 6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上是一段伪代码 </p>
<p>第一注册功能 注册完之后需要给用户<code>发送邮件</code>，<code>初始化默认设置</code>，<code>购买默认套餐</code>，<code>选择默认打包服务</code></p>
<p>第二个是一个下单功能 下单前要做各种检查 没准什么时候又来个<code>购买的服务数量检查</code>等等</p>
</blockquote>
<p>在spring中使用有顺序的责任链</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span>  <span class="class"><span class="keyword">class</span> <span class="title">AfterRegisterHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AfterRegisterHandler next;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">(CustomerInfo customerInfo)</span> </span>&#123;</span><br><span class="line">        doAfter(customerInfo);</span><br><span class="line">        <span class="keyword">if</span> (getNext()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            getNext().doAfter(customerInfo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">doAfter</span><span class="params">(CustomerInfo customerInfo)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Order</span>(<span class="number">1</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultRegisterAfterProcess</span> <span class="keyword">extends</span> <span class="title">RegisterAfterProcess</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfter</span><span class="params">(CustomerInfo customerInfo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 发送邮件</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Order</span>(<span class="number">2</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComboRegisterAfterProcess</span> <span class="keyword">extends</span> <span class="title">RegisterAfterProcess</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfter</span><span class="params">(CustomerInfo customerInfo)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 购买默认套餐</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;RegisterAfterProcess&gt; registerAfterProcessList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initRegisterAfterProcessPattern</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> size = registerAfterProcessList.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == size-<span class="number">1</span>)&#123;</span><br><span class="line">                registerAfterProcessList.get(i).setNext(<span class="keyword">null</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                registerAfterProcessList.get(i).setNext(registerAfterProcessList.get(i+<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(CustomerInfo customerInfo)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 保存用户</span></span><br><span class="line">        save(customerInfo);</span><br><span class="line">        <span class="comment">// 处理 after register</span></span><br><span class="line">        iregisterAfterProcessList.get(<span class="number">0</span>).after(customerInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="可控节点的责任链："><a href="#可控节点的责任链：" class="headerlink" title="可控节点的责任链："></a>可控节点的责任链：</h6><p><a href="https://blog.csdn.net/weixin_33910460/article/details/92608675" target="_blank" rel="noopener">https://blog.csdn.net/weixin_33910460/article/details/92608675</a> </p>
<h5 id="4-模板方法模式"><a href="#4-模板方法模式" class="headerlink" title="4.模板方法模式"></a>4.模板方法模式</h5><p>定义一个操作中的算法骨架，而将算法的一些步骤延迟到子类中，使得子类可以不改变该算法结构的情况下重定义该算法的某些特定步骤。它是一种类行为型模式。</p>
<p><img src="/2020/07/26/%E9%87%8D%E6%9E%84%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/2222997-f9f28c8d942ebd8d.webp" alt="img"></p>
<p>举个栗子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;OrderPoolBo&gt; <span class="title">pullOrder</span><span class="params">(OrderRequest req)</span> </span>&#123;</span><br><span class="line">    String shopType = req.getShopType();</span><br><span class="line">    <span class="keyword">if</span>(shopType == <span class="string">"BS"</span>)&#123;</span><br><span class="line">        List&lt;BsOrder&gt; list = orderProvideToBdFeignClient.pullOrder(req);</span><br><span class="line">        <span class="comment">// 检查订阅关系</span></span><br><span class="line">        <span class="comment">// 过滤订单</span></span><br><span class="line">        <span class="comment">// 转成订单池的订单保存到数据库            </span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (shopType == <span class="string">"shopify"</span>)&#123;</span><br><span class="line">        List&lt;ShopifyOrder&gt; list = shopifyService.pullOrder(req);</span><br><span class="line">        <span class="comment">// 检查订阅关系</span></span><br><span class="line">        <span class="comment">// 过滤订单</span></span><br><span class="line">        <span class="comment">// 转成订单池的订单保存到数据库</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(shopType == <span class="string">"wooc"</span>)&#123;</span><br><span class="line">        List&lt;woocOrer&gt; list = woocService.pullOrder(req);</span><br><span class="line">        <span class="comment">// 检查订阅关系</span></span><br><span class="line">        <span class="comment">// 过滤订单</span></span><br><span class="line">        <span class="comment">// 转成订单池的订单保存到数据库</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上使我们目前拉单的一段代码流程大致相似 调用不同的第三方不同类型的订单最后过滤转化成统一的订单池订单，我们可以把相同的流程抽象出来不同的订单用泛型实现</p>
<p><strong>重构后的UM类图</strong></p>
<p><img src="/2020/07/26/%E9%87%8D%E6%9E%84%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20200727001143558.png" alt="image-20200727001143558"></p>
<p><strong>店铺安装或者绑定类图</strong></p>
<p><img src="/2020/07/26/%E9%87%8D%E6%9E%84%E4%B9%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20200727001352214.png" alt="image-20200727001352214"></p>
<h4 id="设计模式落地"><a href="#设计模式落地" class="headerlink" title="设计模式落地"></a>设计模式落地</h4><p>设计模式提供的更多的是一种设计思想，如何运用还是要结合实际的场景。对于一个功能和需求一开始并不建议强扣设计模式，很多时候刚开始的需求是相对简单的，经过慢慢积累变的复杂化，这时候我们要改一些逻辑可能真的要牵一发而动全身，随着需求的不断完善我们可以从中抽丝剥茧提炼出一些公用的或者流程性的点，去不断的优化自己的代码。世界上没有完美的设计模式，结合自己的业务提供最大限度的可扩展、修改方便、阅读清晰就是最适合的设计模式，当然这也不是一蹴而就的代码本身就是一个不断优化的过程，只是设计模式会给我们提供多一点的参考，更多的是需要尝试解耦去分析业务以及在实际场景中的应用去实践。</p>
</div></article></div><div id="disqus_thread"></div></div></main><footer class="footer-container"><div class="paginator"><a href="/test_page/2020/07/12/NIO-buffer/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2020 <a href="http://www.igeekcoder.com/test_page">EthanXQ</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"igeekcoder",'auto');ga('send','pageview');</script></body></html>